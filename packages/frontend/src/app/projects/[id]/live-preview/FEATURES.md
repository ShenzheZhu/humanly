# Live Preview Page - Feature Summary

## Page Location
`/home/ubuntu/humory/packages/frontend/src/app/(dashboard)/projects/[id]/live-preview/page.tsx`

## Visual Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Live Preview                                    [Tracking Code] [Back]â”‚
â”‚ Monitor user sessions and events in real-time                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚ â”‚Connectionâ”‚ â”‚  Active  â”‚ â”‚  Events  â”‚ â”‚Events/Secâ”‚                â”‚
â”‚ â”‚ Connectedâ”‚ â”‚Sessions:3â”‚ â”‚Received:â”‚ â”‚   2.45   â”‚                â”‚
â”‚ â”‚   [â—]    â”‚ â”‚          â”‚ â”‚   157   â”‚ â”‚          â”‚                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚  Event Stream                                       â”‚
â”‚ Active       â”‚  Showing 45 of 157 events                          â”‚
â”‚ Sessions     â”‚  [â–¼ Filters (2)] [ğŸ‘ Auto-scroll] [â¸ Pause] [ğŸ—‘ Clear]â”‚
â”‚              â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚User: 123 â”‚â”‚ â”‚ [keydown] 2:34:15 PM                          â”‚  â”‚
â”‚ â”‚8 events  â”‚â”‚ â”‚ user-123 â€¢ abc12345...                        â”‚  â”‚
â”‚ â”‚5m ago    â”‚â”‚ â”‚ Key: A â€¢ Field: email                         â”‚  â”‚
â”‚ â”‚abc12... â”‚â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ [paste] 2:34:12 PM                            â”‚  â”‚
â”‚             â”‚ â”‚ user-456 â€¢ def67890...                        â”‚  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ Pasted: "example@email.com"                   â”‚  â”‚
â”‚ â”‚User: 456 â”‚â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚3 events  â”‚â”‚ â”‚ [focus] 2:34:08 PM                            â”‚  â”‚
â”‚ â”‚Just now  â”‚â”‚ â”‚ user-789 â€¢ ghi34567...                        â”‚  â”‚
â”‚ â”‚def67... â”‚â”‚ â”‚ Field: password                               â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚             â”‚ â”‚ ...more events...                             â”‚  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚                                               â”‚  â”‚
â”‚ â”‚User: 789 â”‚â”‚ â”‚                                               â”‚  â”‚
â”‚ â”‚2 events  â”‚â”‚ â”‚                                               â”‚  â”‚
â”‚ â”‚Just now  â”‚â”‚ â”‚                                               â”‚  â”‚
â”‚ â”‚ghi34... â”‚â”‚ â”‚                                               â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚                                               â”‚  â”‚
â”‚             â”‚ â”‚                                               â”‚  â”‚
â”‚             â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Feature Breakdown

### 1. WebSocket Connection Management
- âœ… Auto-connect on page load
- âœ… JWT authentication with access token
- âœ… Connection status display (4 states)
- âœ… Automatic reconnection on failure
- âœ… Join/leave project rooms
- âœ… Proper cleanup on unmount

### 2. Real-time Event Stream
- âœ… Live feed updates as events arrive
- âœ… Most recent events shown first
- âœ… Event details displayed:
  - Timestamp (formatted)
  - Event type (color-coded badge)
  - User ID
  - Session ID (shortened)
  - Field name
  - Key pressed / text content
  - Cursor position
- âœ… Alternating row colors for readability
- âœ… Scrollable list with fixed header
- âœ… Memory limit (500 events max)

### 3. Event Type Color Coding
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ keydown â”‚ Blue (darker) - bg-blue-100          â”‚
â”‚ keyup   â”‚ Blue (lighter) - bg-blue-50          â”‚
â”‚ paste   â”‚ Green - bg-green-100                 â”‚
â”‚ copy    â”‚ Yellow - bg-yellow-100               â”‚
â”‚ cut     â”‚ Orange - bg-orange-100               â”‚
â”‚ focus   â”‚ Purple - bg-purple-100               â”‚
â”‚ blur    â”‚ Gray - bg-gray-100                   â”‚
â”‚ input   â”‚ Cyan - bg-cyan-100                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Advanced Filtering
- âœ… Event Type Filter (checkboxes for each type)
- âœ… User ID text filter
- âœ… Session ID text filter
- âœ… Active filter count indicator
- âœ… Clear all filters button
- âœ… Collapsible filter panel
- âœ… Real-time filter application

### 5. Session Monitoring Sidebar
- âœ… List of active sessions
- âœ… Per-session information:
  - User ID
  - Session ID (shortened)
  - Start time (relative)
  - Event count
- âœ… Independent scroll area
- âœ… Hover effects
- âœ… Real-time updates

### 6. Live Statistics
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Connection   â”‚ Active    â”‚ Events    â”‚ Events/  â”‚
â”‚ Status       â”‚ Sessions  â”‚ Received  â”‚ Second   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Connected    â”‚ 3         â”‚ 157       â”‚ 2.45     â”‚
â”‚ [â—] Green    â”‚ Currently â”‚ Total     â”‚ Live rateâ”‚
â”‚              â”‚ tracking  â”‚ received  â”‚ (5s avg) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7. Control Panel
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â–¼ Filters (2)]  - Toggle filter panel          â”‚
â”‚ [ğŸ‘ Auto-scroll] - Enable/disable auto-scroll   â”‚
â”‚ [â¸ Pause]       - Pause/resume event reception  â”‚
â”‚ [ğŸ—‘ Clear]       - Clear event list             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8. Empty States

#### No Connection
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [âŒ› Loading Spinner]              â”‚
â”‚                                         â”‚
â”‚          Connecting...                  â”‚
â”‚   Establishing connection to            â”‚
â”‚       event stream                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### No Events (Connected)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [ğŸ“Š Activity Icon]               â”‚
â”‚                                         â”‚
â”‚          No Events Yet                  â”‚
â”‚   Waiting for events to be tracked...   â”‚
â”‚                                         â”‚
â”‚   Make sure you have added the          â”‚
â”‚   tracking code to your survey or form. â”‚
â”‚                                         â”‚
â”‚   [View Tracking Code] (button)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### No Events (Filtered)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [ğŸ“Š Activity Icon]               â”‚
â”‚                                         â”‚
â”‚          No Events Yet                  â”‚
â”‚   No events match your current filters. â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technical Implementation

### State Management
```typescript
// Connection
const [connectionStatus, setConnectionStatus] = useState<ConnectionStatus>('disconnected');
const [connectionError, setConnectionError] = useState<string | null>(null);

// Events
const [events, setEvents] = useState<RealtimeEvent[]>([]);
const [sessions, setSessions] = useState<Map<string, SessionInfo>>(new Map());
const [isPaused, setIsPaused] = useState(false);
const [autoScroll, setAutoScroll] = useState(true);

// Filters
const [selectedEventTypes, setSelectedEventTypes] = useState<Set<EventType>>(new Set());
const [userIdFilter, setUserIdFilter] = useState('');
const [sessionIdFilter, setSessionIdFilter] = useState('');

// Stats
const [totalEventsReceived, setTotalEventsReceived] = useState(0);
const [eventsPerSecond, setEventsPerSecond] = useState(0);
```

### WebSocket Event Handlers
```typescript
socket.on('connect', () => {
  // Set connected status, join room
});

socket.on('disconnect', (reason) => {
  // Set disconnected status, handle reconnection
});

socket.on('session-started', (data) => {
  // Add session to sessions map
});

socket.on('event-received', (data) => {
  // Add event to list (if not paused)
  // Update session event count
  // Update statistics
});

socket.on('session-ended', (data) => {
  // Mark session as ended
});
```

### Performance Optimizations
1. **Memory Management**: Limit to 500 events
2. **Rate Calculation**: 5-second sliding window
3. **Efficient Filtering**: Apply during render
4. **Auto-scroll**: Only when enabled
5. **Pause Feature**: Stop processing without disconnecting

## Integration Points

### Backend Requirements
```typescript
// WebSocket server must emit:
- 'session-started': { sessionId, userId, timestamp }
- 'event-received': { eventId, sessionId, userId, eventType, timestamp, data }
- 'session-ended': { sessionId, userId, timestamp }

// WebSocket server must accept:
- 'join-project': projectId
- 'leave-project': projectId
```

### Environment Variables
```bash
NEXT_PUBLIC_WS_URL=http://localhost:3001
```

### Dependencies
- `socket.io-client`: ^4.6.1
- `@radix-ui/react-scroll-area`: ^1.0.5
- `class-variance-authority`: ^0.7.0
- `lucide-react`: ^0.303.0

## UI Components Created

1. **Badge Component** (`/components/ui/badge.tsx`)
   - Variants: default, secondary, destructive, outline
   - Used for event types and status indicators

2. **ScrollArea Component** (`/components/ui/scroll-area.tsx`)
   - Radix UI scroll area wrapper
   - Smooth scrolling with custom scrollbar
   - Used for event list and session sidebar

## Files Created

1. **Main Page**: `/app/(dashboard)/projects/[id]/live-preview/page.tsx` (729 lines)
2. **Badge Component**: `/components/ui/badge.tsx`
3. **ScrollArea Component**: `/components/ui/scroll-area.tsx`
4. **Documentation**: `/app/(dashboard)/projects/[id]/live-preview/README.md`
5. **Feature Summary**: `/app/(dashboard)/projects/[id]/live-preview/FEATURES.md`
6. **Updated**: `/package.json` (added @radix-ui/react-scroll-area)

## Responsive Design

### Desktop (md and above)
- 4-column stat cards
- 1-column sidebar + 3-column event feed
- Full control panel visible

### Mobile
- Stacked stat cards
- Full-width event feed
- Collapsible session sidebar
- Compact controls

## Accessibility Features

- âœ… Semantic HTML structure
- âœ… ARIA labels on interactive elements
- âœ… Keyboard navigation support
- âœ… Screen reader friendly text
- âœ… Color contrast compliant
- âœ… Focus indicators

## Testing Recommendations

1. **Connection Testing**
   - Connect with valid token
   - Connect with invalid token
   - Test reconnection on disconnect
   - Test error states

2. **Event Reception**
   - Receive single events
   - Receive rapid burst of events
   - Test different event types
   - Verify event details display

3. **Filtering**
   - Filter by each event type
   - Filter by user ID
   - Filter by session ID
   - Combine multiple filters

4. **Controls**
   - Pause and resume
   - Clear events
   - Toggle auto-scroll
   - Toggle filters

5. **Performance**
   - Test with 500+ events
   - Test with multiple sessions
   - Verify memory limits
   - Check events/second calculation

6. **Responsive**
   - Test on mobile devices
   - Test on tablets
   - Test on desktop
   - Verify all breakpoints
